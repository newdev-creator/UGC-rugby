{{ include('partials/main.html.twig') }}

<head>

    {{ include('partials/title-meta.html.twig', {title: 'Profile'}) }}

    <!-- swiper css -->
    <link rel="stylesheet" href="{{ asset('/libs/swiper/swiper-bundle.min.css') }}">

    {{ include('partials/head-css.html.twig') }}

</head>

<body>

    <!-- Begin page -->
    <div id="layout-wrapper">

        {{ include('partials/menu.html.twig') }}

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">

                <div class="row">
                    <div class="col-12">
                        {% for label, messages in app.flashes %}
                            {% for message in messages %}
                                <div class="alert alert-{{ label }} shadow d-flex justify-content-between mb-2 z-99" role="alert">
                                    <strong> {{ message }} </strong>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endfor %}
                        {% endfor %}
                    </div>
                </div>

                    <div class="profile-foreground position-relative mx-n4 mt-n4">
                        <div class="profile-wid-bg">
                            <img src="/images/profile-bg.jpg" alt="" class="profile-wid-img" />
                        </div>
                    </div>
                    <div class="pt-4 mb-4 mb-lg-3 pb-lg-4">
                        <div class="row g-4">
                            <div class="col-auto">
                                <div class="avatar-lg">
                                    <img src="/images/users/avatar-1.jpg" alt="user-img" class="img-thumbnail rounded-circle" />
                                </div>
                            </div>
                            <div class="col">
                                <div class="p-2">
                                    <h3 class="text-white mb-1">{{ user.getIdentity }}</h3>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <div>
                                <div class="d-flex justify-content-end">
                                        <a href="{{ path('settings_show', {'user': user.id}) }}" class="btn btn-success"><i class="ri-edit-box-line align-bottom"></i> Paramètres</a>
                                    </div>
                                </div>
                                <!-- Tab panes -->
                                <div class="tab-content pt-4 text-muted">
                                    <div class="tab-pane active" id="overview-tab" role="tabpanel">
                                        <div class="row">
                                            <div class="col-xxl-3">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <h5 class="card-title mb-3">Info</h5>
                                                        <div class="table-responsive">
                                                            <table class="table table-borderless mb-0">
                                                                <tbody>
                                                                    <tr>
                                                                        <th class="ps-0" scope="row">Téléphone :</th>
                                                                        <td class="text-muted">{{ user.phone }}</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th class="ps-0" scope="row">E-mail :</th>
                                                                        <td class="text-muted">{{ user.email }}</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th class="ps-0" scope="row">Adresse :</th>
                                                                        <td class="text-muted">{{ user.address }} {{ user.postalCode }} {{ user.city }}</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th class="ps-0" scope="row">Date d'inscription</th>
                                                                        <td class="text-muted">{{ user.addedAt|date ('d M, Y') }}</td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div><!-- end card body -->
                                                </div><!-- end card -->

                                                <div class="card">
                                                    <div class="card-body">
                                                        <div class="d-flex align-items-center mb-4">
                                                            <div class="flex-grow-1">
                                                                <h5 class="card-title mb-0">Vos enfants</h5>
                                                            </div>
                                                            <div class="flex-shrink-0">
                                                                <button 
                                                                    type="button" 
                                                                    class="btn btn-success" 
                                                                    data-bs-toggle="modal" 
                                                                    data-bs-target="#newChildModal"
                                                                >
                                                                    <i class="ri-add-box-line align-bottom"></i> 
                                                                        Ajouter
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            {% for child in active_child %}
                                                                {% if child %}
                                                                    <div class="d-flex align-items-center py-3">
                                                                        <div class="avatar-xs flex-shrink-0 me-3">
                                                                            <img src="/images/users/avatar-3.jpg" alt="" class="img-fluid rounded-circle shadow" />
                                                                        </div>
                                                                        <div class="flex-grow-1">
                                                                            <div>
                                                                                <h5 class="fs-14 mb-1">{{ child.getIdentity }}</h5>
                                                                                <p class="fs-13 text-muted mb-0">
                                                                                    <div class="badge rounded-pill bg-danger fs-12">{{ child.category.name }}</div>
                                                                                </p>
                                                                            </div>
                                                                        </div>
                                                                        <div class="flex-shrink-0">
                                                                            {% include "site/user/_delete_child.html.twig" %}
                                                                        </div>
                                                                    </div>
                                                                {% endif %}
                                                                {% else %}
                                                                    <div class="d-flex align-items-center py-3">
                                                                        <p>Aucun enfants renseigné...</p>
                                                                    </div>
                                                            {% endfor %}
                                                            
                                                        </div>
                                                    </div><!-- end card body -->
                                                </div>
                                                <!--end card-->
                                                
                                            </div>
                                            <!--end col-->
                                            <div class="col-xxl-9">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <h5 class="card-title mb-3">Evénements Inscrits</h5>
                                                        <div class="table-responsive">
                                                            {% if events is empty %}
                                                                <p>Aucun événement à afficher...</p>
                                                            {% else %}
                                                                <table class="table table-nowrap">
                                                                    <thead>
                                                                        <tr>
                                                                            <th scope="col">Evénements</th>
                                                                            <th scope="col">Date</th>
                                                                            <th scope="col">Adresse</th>
                                                                            <th scope="col">Enfants</th>
                                                                            <th scope="col">Action</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        {% for event in events %}
                                                                            <tr>
                                                                                <th scope="row"><a href="{{ path('event_show', {'event': event.id}) }}" class="fw-semibold">{{ event.title }}</a></th>
                                                                                <td>
                                                                                    {{ event.date|date('l j F Y à H:i', 'Europe/Paris') }}
                                                                                </td>
                                                                                <td>
                                                                                    {{ event.address }} <br>
                                                                                    {{ event.postalCode }} {{ event.city }}
                                                                                </td>
                                                                                <td>
                                                                                    {% for child in event.child  %}
                                                                                        {% if child.user == user %}
                                                                                            {{ child.getIdentity }} <br>
                                                                                        {% endif %}
                                                                                    {% endfor %}
                                                                                </td>
                                                                                <td>
                                                                                    <a 
                                                                                        href="{{ path('event_show', {'event': event.id}) }}" 
                                                                                        class="btn btn-success">
                                                                                            Voir 
                                                                                        <i class="ri-arrow-right-line align-middle"></i>
                                                                                    </a>
                                                                                </td>
                                                                            </tr>
                                                                        {% endfor %}
                                                                    </tbody>
                                                                </table>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="card">
                                                    <div class="card-body">
                                                        <h5 class="card-title mb-3">Covoiturage Inscrits</h5>
                                                        <div class="table-responsive">
                                                            {% if carpools is empty %}
                                                                <p>Aucun covoiturage à afficher...</p>
                                                            {% else %}
                                                                <table class="table table-nowrap">
                                                                    <thead>
                                                                        <tr>
                                                                            <th scope="col">Evénement</th>
                                                                            <th scope="col">Covoitureur</th>
                                                                            <th scope="col">Date</th>
                                                                            <th scope="col">Adresse</th>
                                                                            <th scope="col">Enfants</th>
                                                                            <th scope="col">Action</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        {% for carpool in carpools %}
                                                                            <tr>
                                                                                <th scope="row"><a href="{{ path('event_show', {'event': carpool.event.id}) }}" class="fw-semibold">{{ carpool.event.title }}</a></th>
                                                                                <th scope="row">
                                                                                    <a
                                                                                        href="{{ path('carpool_show', {'carpool': carpool.id}) }}"
                                                                                        class="fw-semibold">
                                                                                        {% for user in carpool.users %}
                                                                                            {{   user.getIdentity }}
                                                                                        {% endfor %}
                                                                                    </a>
                                                                                </th>
                                                                                <td>
                                                                                    {{ carpool.date|date('l j F Y à H:i', 'Europe/Paris') }}
                                                                                </td>
                                                                                <td>
                                                                                    {{ carpool.address }} <br>
                                                                                    {{ carpool.postalCode }} {{ carpool.city }}
                                                                                </td>
                                                                                <td>
                                                                                    {% for child in carpool.child  %}
                                                                                        {% if child.user == user %}
                                                                                            {{ child.getIdentity }} <br>
                                                                                        {% endif %}
                                                                                    {% endfor %}
                                                                                </td>
                                                                                <td>
                                                                                    <a 
                                                                                        href="{{ path('carpool_show', {'carpool': carpool.id}) }}"
                                                                                        class="btn btn-success">
                                                                                            Voir 
                                                                                        <i class="ri-arrow-right-line align-middle"></i>
                                                                                    </a>
                                                                                </td>
                                                                            </tr>
                                                                        {% endfor %}
                                                                    </tbody>
                                                                </table>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card">
                                                    <div class="card-body">
                                                        <h5 class="card-title mb-3">Vos Covoiturages</h5>
                                                        <div class="table-responsive">
                                                            {% if carpools is empty %}
                                                                <p>Vous n'avez aucun covoiturage...</p>
                                                            {% else %}
                                                                <table class="table table-nowrap">
                                                                    <thead>
                                                                    <tr>
                                                                        <th scope="col">Evénement</th>
                                                                        <th scope="col">Date</th>
                                                                        <th scope="col">Adresse</th>
                                                                        <th scope="col">Enfants</th>
                                                                        <th scope="col">Action</th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                    {% for carpool in user_carpools %}
                                                                        <tr>
                                                                            <th scope="row"><a href="{{ path('event_show', {'event': carpool.event.id}) }}" class="fw-semibold">{{ carpool.event.title }}</a></th>
                                                                            <td>
                                                                                {{ carpool.date|date('l j F Y à H:i', 'Europe/Paris') }}
                                                                            </td>
                                                                            <td>
                                                                                {{ carpool.address }} <br>
                                                                                {{ carpool.postalCode }} {{ carpool.city }}
                                                                            </td>
                                                                            <td>
                                                                                {% for child in carpool.child  %}
                                                                                        {{ child.getIdentity }} <br>
                                                                                {% endfor %}
                                                                            </td>
                                                                            <td>
                                                                                <a
                                                                                    href="{{ path('carpool_show', {'carpool': carpool.id}) }}"
                                                                                    class="btn btn-success"
                                                                                >
                                                                                    Voir
                                                                                    <i class="ri-arrow-right-line align-middle"></i>
                                                                                </a>
                                                                                {# {{ include('site/user/_delete_carpool.html.twig') }} #}
                                                                            </td>
                                                                        </tr>
                                                                    {% endfor %}
                                                                    </tbody>
                                                                </table>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--end col-->
                                        </div>
                                        <!--end row-->
                                    </div>
                                    
                                </div>
                                <!--end tab-content-->
                            </div>
                        </div>
                        <!--end col-->
                    </div>
                    <!--end row-->

                </div><!-- container-fluid -->
            </div><!-- End Page-content -->

            {{ include('partials/footer.html.twig') }}
        </div><!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

    <!-- Modal -->
<div class="modal fade" id="newChildModal" tabindex="-1" aria-labelledby="newChildModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0">
            <div class="modal-header p-3 ps-4 bg-soft-success">
                <h5 class="modal-title" id="newChildModalLabel">Ajouter un enfant</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <div class="mb-4 d-flex align-items-center">
                    <div class="me-2">
                        <div class="alert alert-info shadow" role="alert">
                            <strong>Don't forget' it !</strong> A simple <b>info alert</b> —check it out!
                        </div>
                    </div>
                </div>
                {{ form_start(form_new_child) }}
                    {{ form_widget(form_new_child) }}
                    <button type="submit" class="btn btn-success">Enregistrer</button>
                {{ form_end(form_new_child) }}
            </div>
        </div>
        <!-- end modal-content -->
    </div>
    <!-- modal-dialog -->
</div>
<!-- end modal -->

    {{ include('partials/vendor-scripts.html.twig') }}

{% block javascripts %}
        <!-- swiper js -->
    <script src="{{ asset('/libs/swiper/swiper-bundle.min.js') }}"></script>

    <!-- profile init js -->
    <script src="{{ asset('/js/pages/profile.init.js') }}"></script>

    <!-- App js -->
    <script src="{{ asset('/js/app.js') }}"></script>
{% endblock %}
</body>

</html>